<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>나만의 강아지 키우기 🐾</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap');
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Gowun Dodum', sans-serif;
      background-color: #fff8f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-bottom: 50px;
    }
    h1 {
      margin: 30px 0;
      font-size: 2.8rem;
      color: #ff914d;
      text-align: center;
    }
    .screen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .active {
      display: flex !important;
    }
    .button {
      padding: 12px 24px;
      margin: 10px;
      font-size: 1.1rem;
      background: #ffcdcd;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: background 0.2s;
    }
    .button:hover {
      background: #ffa4a4;
    }
    input {
      padding: 10px;
      font-size: 1rem;
      border-radius: 10px;
      border: 1px solid #ccc;
      margin-top: 10px;
      width: 200px;
      text-align: center;
    }
    #game-wrapper {
      width: 95%;
      max-width: 1000px;
      aspect-ratio: 4 / 3;
      position: relative;
      background: #ffffff;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }
    #statusBar {
      display: flex;
      justify-content: space-between;
      background: #fff0e1;
      padding: 10px 20px;
      border-bottom: 2px solid #ffcdb2;
      font-size: 1rem;
    }
    #dogImage {
      width: 300px;
      height: auto;
      border-radius: 20px;
      margin: 10px 0;
    }
    .event-box {
      background: #ffe5d9;
      padding: 15px;
      border-radius: 15px;
      margin-top: 10px;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 600px;
    }
    .event-text {
      font-size: 1.2rem;
      color: #6b4c3b;
    }
    .choice-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
    }
    .choice-buttons button {
      background-color: #ffb4a2;
      border: none;
      padding: 10px 15px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1rem;
    }
    .choice-buttons button:hover {
      background-color: #ff9e80;
    }
    #interaction-panel {
      display: none;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
    }
    #interaction-toggle {
      margin-top: 10px;
      background-color: #cdb4db;
    }
    .interaction-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }
    .interaction-buttons button {
      padding: 8px 14px;
      border-radius: 10px;
      background-color: #a3c4f3;
      border: none;
      cursor: pointer;
    }
    .interaction-buttons button:hover {
      background-color: #90b4e3;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>나만의 강아지 키우기 🐶</h1>
  <audio id="bgm" autoplay loop>
    <source src="https://dessa1995.github.io/dessa/bgm.mp3" type="audio/mp3" />
  </audio>
  <div id="game-wrapper">
    <div id="statusBar">
      <div>이름: <span id="dogNameDisplay">???</span></div>
      <div>나이: <span id="ageDisplay">0</span>살</div>
      <div>친밀도: <span id="friendlinessDisplay">0</span></div>
      <div>배고픔: <span id="hungerDisplay">0</span></div>
      <div>다음 이벤트까지: <span id="eventCountdown">5</span>초</div>
    </div>
    <img id="dogImage" src="" alt="강아지 이미지">
    <div id="eventContainer" class="event-box hidden">
      <div class="event-text" id="eventText"></div>
      <div class="choice-buttons" id="eventChoices"></div>
    </div>
    <button id="interaction-toggle">직접 상호작용 🔄</button>
    <div id="interaction-panel">
      <div class="interaction-buttons">
        <button onclick="interact('쓰다듬기')">쓰다듬기 🖐️</button>
        <button onclick="interact('껴안기')">껴안기 🤗</button>
        <button onclick="interact('귀 냄새 맡기')">귀 냄새 맡기 👂</button>
        <button onclick="interact('발 냄새 맡기')">발 냄새 맡기 🦶</button>
      </div>
    </div>
  </div>

  <script>
    const dogImage = document.getElementById('dogImage');
    const eventContainer = document.getElementById('eventContainer');
    const eventText = document.getElementById('eventText');
    const eventChoices = document.getElementById('eventChoices');
    const dogNameDisplay = document.getElementById('dogNameDisplay');
    const ageDisplay = document.getElementById('ageDisplay');
    const friendlinessDisplay = document.getElementById('friendlinessDisplay');
    const hungerDisplay = document.getElementById('hungerDisplay');
    const eventCountdown = document.getElementById('eventCountdown');
    const interactionPanel = document.getElementById('interaction-panel');
    const interactionToggle = document.getElementById('interaction-toggle');

    let age = 0;
    let friendliness = 0;
    let hunger = 0;
    let breed = '';
    let dogName = '';
    let eventTimer, ageTimer;
    let growthStage = 0; // 0:신생아, 1:청소년, 2:성견, 3:노령기
    let isGrowing = false;
    let gameEnded = false;

    const dogImages = {
      g: ['g1.png', 'g2.png', 'g3.png', 'g4.png'],
      b: ['b1.png', 'b2.png', 'b3.png', 'b4.png']
    };

    const growthMessages = ['👶 신생아기', '🧒 청소년기', '🐕 성견기', '🦮 노령기'];

    const randomEvents = [
      { text: '배고파하는 것 같아요.', choices: ['간식을 준다', '무시한다'], effect: [2, -1] },
      { text: '산책을 나가고 싶어 해요.', choices: ['산책을 나간다', '무시한다'], effect: [3, -2] },
      { text: '같이 놀고 싶어 해요.', choices: ['같이 논다', '무시한다'], effect: [2, -1] },
      { text: '짖는 걸 멈추지 않아요.', choices: ['안아준다', '무시한다'], effect: [1, -1] },
      { text: '기운이 없어 보여요.', choices: ['간식을 준다', '무시한다'], effect: [2, -2] },
      { text: '귀찮게 굴어요.', choices: ['무릎에 앉힌다', '무시한다'], effect: [2, -1] },
      { text: '갑자기 짖어요!', choices: ['쓰다듬는다', '무시한다'], effect: [2, -1] },
      { text: '귀가 간지러운 것 같아요.', choices: ['귀를 닦아준다', '무시한다'], effect: [2, -1] },
      { text: '배를 보여요!', choices: ['배를 쓰다듬는다', '무시한다'], effect: [3, -1] },
      { text: '잠이 안 오는 것 같아요.', choices: ['자장가를 불러준다', '무시한다'], effect: [2, -2] }
    ];

    interactionToggle.onclick = () => {
      interactionPanel.style.display = interactionPanel.style.display === 'flex' ? 'none' : 'flex';
    };
    function updateStatusPanel() {
      document.getElementById('age-value').textContent = age;
      document.getElementById('friendliness-value').textContent = friendliness;
      document.getElementById('hunger-value').textContent = hunger;
    }

    function showEvent(text, choiceA, choiceB, effectA, effectB) {
      isGrowing = true;
      document.getElementById('event-message').textContent = `${dogName}이(가) ${text}`;
      document.getElementById('event-choices').style.display = 'flex';
      document.getElementById('choiceA').textContent = choiceA;
      document.getElementById('choiceB').textContent = choiceB;

      const handleChoice = (effect) => {
        friendliness += effect;
        hunger += (effect > 0 ? -1 : 1);
        updateStatusPanel();
        document.getElementById('event-choices').style.display = 'none';
        isGrowing = false;
      };

      document.getElementById('choiceA').onclick = () => handleChoice(effectA);
      document.getElementById('choiceB').onclick = () => handleChoice(effectB);
    }

    function triggerRandomEvent() {
      if (isGrowing || gameEnded) return;
      const i = Math.floor(Math.random() * randomEvents.length);
      const e = randomEvents[i];
      showEvent(e.text, e.choices[0], e.choices[1], e.effect[0], e.effect[1]);
    }

    function triggerGrowth() {
      if (isGrowing || gameEnded) return;
      growthStage++;
      if (growthStage > 3) {
        setTimeout(showEnding, 60000);
        return;
      }
      isGrowing = true;
      const growthDiv = document.createElement('div');
      growthDiv.className = 'event-box';
      growthDiv.innerHTML = `<strong>🎉 ${dogName}이(가) ${growthMessages[growthStage]}로 성장했어요!</strong><br><button onclick="continueAfterGrowth(this)">축하해</button>`;
      document.getElementById('event').appendChild(growthDiv);
      updateDogImage();
    }

    function continueAfterGrowth(btn) {
      btn.parentElement.remove();
      isGrowing = false;
    }

    function updateDogImage() {
      dogImg.src = `https://dessa1995.github.io/dessa/${dogImages[breed][growthStage]}`;
    }

    function startTimers() {
      updateStatusPanel();
      eventTimer = setInterval(() => {
        timeUntilEvent -= 1;
        if (timeUntilEvent <= 0) {
          timeUntilEvent = 5;
          triggerRandomEvent();
        }
        document.getElementById('timer').textContent = timeUntilEvent;
      }, 1000);

      ageTimer = setInterval(() => {
        age++;
        updateStatusPanel();
        if (age === 2 || age === 6 || age === 10) {
          triggerGrowth();
        }
      }, 20000);
    }
    function showEnding() {
      clearInterval(eventTimer);
      clearInterval(ageTimer);
      gameEnded = true;

      const album = document.createElement('div');
      album.className = 'event-box';
      album.innerHTML = `
        <strong>📸 추억 앨범</strong><br>
        <p>${dogName}이(가) 예쁘고 멋지게 자랐어요!</p>
        <img src="${dogImg.src}" style="width:200px; border-radius:16px; margin:10px 0;">
        <p>친밀도: ${friendliness} / 배고픔: ${hunger}</p>
        <button onclick="restartGame()">다시 시작하기</button>
      `;
      document.getElementById('event').appendChild(album);
    }

    function restartGame() {
      location.reload();
    }

    // 배경음악 강제 시작 (Chrome 등 일부 브라우저 정책 대응)
    document.addEventListener('click', () => {
      const bgm = document.getElementById('bgm');
      if (bgm && bgm.paused) bgm.play().catch(() => {});
    }, { once: true });
  </script>
</body>
</html>
