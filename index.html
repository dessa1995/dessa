<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë‚˜ë§Œì˜ ê°•ì•„ì§€ í‚¤ìš°ê¸° ğŸ¾</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap');
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Gowun Dodum', sans-serif;
      background-color: #fff8f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-bottom: 50px;
    }
    h1 {
      margin: 30px 0;
      font-size: 2.8rem;
      color: #ff914d;
      text-align: center;
    }
    .screen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .active {
      display: flex !important;
    }
    .button {
      padding: 12px 24px;
      margin: 10px;
      font-size: 1.1rem;
      background: #ffcdcd;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: background 0.2s;
    }
    .button:hover {
      background: #ffa4a4;
    }
    input {
      padding: 10px;
      font-size: 1rem;
      border-radius: 10px;
      border: 1px solid #ccc;
      margin-top: 10px;
      width: 200px;
      text-align: center;
    }
    #game-wrapper {
      width: 95%;
      max-width: 1000px;
      aspect-ratio: 4 / 3;
      position: relative;
      background: #ffffff;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }
    #statusBar {
      display: flex;
      justify-content: space-between;
      background: #fff0e1;
      padding: 10px 20px;
      border-bottom: 2px solid #ffcdb2;
      font-size: 1rem;
    }
    #dogImage {
      width: 300px;
      height: auto;
      border-radius: 20px;
      margin: 10px 0;
    }
    .event-box {
      background: #ffe5d9;
      padding: 15px;
      border-radius: 15px;
      margin-top: 10px;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 600px;
    }
    .event-text {
      font-size: 1.2rem;
      color: #6b4c3b;
    }
    .choice-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
    }
    .choice-buttons button {
      background-color: #ffb4a2;
      border: none;
      padding: 10px 15px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1rem;
    }
    .choice-buttons button:hover {
      background-color: #ff9e80;
    }
    #interaction-panel {
      display: none;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
    }
    #interaction-toggle {
      margin-top: 10px;
      background-color: #cdb4db;
    }
    .interaction-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }
    .interaction-buttons button {
      padding: 8px 14px;
      border-radius: 10px;
      background-color: #a3c4f3;
      border: none;
      cursor: pointer;
    }
    .interaction-buttons button:hover {
      background-color: #90b4e3;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>ë‚˜ë§Œì˜ ê°•ì•„ì§€ í‚¤ìš°ê¸° ğŸ¶</h1>
  <audio id="bgm" autoplay loop>
    <source src="https://dessa1995.github.io/dessa/bgm.mp3" type="audio/mp3" />
  </audio>
  <div id="game-wrapper">
    <div id="statusBar">
      <div>ì´ë¦„: <span id="dogNameDisplay">???</span></div>
      <div>ë‚˜ì´: <span id="ageDisplay">0</span>ì‚´</div>
      <div>ì¹œë°€ë„: <span id="friendlinessDisplay">0</span></div>
      <div>ë°°ê³ í””: <span id="hungerDisplay">0</span></div>
      <div>ë‹¤ìŒ ì´ë²¤íŠ¸ê¹Œì§€: <span id="eventCountdown">5</span>ì´ˆ</div>
    </div>
    <img id="dogImage" src="" alt="ê°•ì•„ì§€ ì´ë¯¸ì§€">
    <div id="eventContainer" class="event-box hidden">
      <div class="event-text" id="eventText"></div>
      <div class="choice-buttons" id="eventChoices"></div>
    </div>
    <button id="interaction-toggle">ì§ì ‘ ìƒí˜¸ì‘ìš© ğŸ”„</button>
    <div id="interaction-panel">
      <div class="interaction-buttons">
        <button onclick="interact('ì“°ë‹¤ë“¬ê¸°')">ì“°ë‹¤ë“¬ê¸° ğŸ–ï¸</button>
        <button onclick="interact('ê»´ì•ˆê¸°')">ê»´ì•ˆê¸° ğŸ¤—</button>
        <button onclick="interact('ê·€ ëƒ„ìƒˆ ë§¡ê¸°')">ê·€ ëƒ„ìƒˆ ë§¡ê¸° ğŸ‘‚</button>
        <button onclick="interact('ë°œ ëƒ„ìƒˆ ë§¡ê¸°')">ë°œ ëƒ„ìƒˆ ë§¡ê¸° ğŸ¦¶</button>
      </div>
    </div>
  </div>

  <script>
    const dogImage = document.getElementById('dogImage');
    const eventContainer = document.getElementById('eventContainer');
    const eventText = document.getElementById('eventText');
    const eventChoices = document.getElementById('eventChoices');
    const dogNameDisplay = document.getElementById('dogNameDisplay');
    const ageDisplay = document.getElementById('ageDisplay');
    const friendlinessDisplay = document.getElementById('friendlinessDisplay');
    const hungerDisplay = document.getElementById('hungerDisplay');
    const eventCountdown = document.getElementById('eventCountdown');
    const interactionPanel = document.getElementById('interaction-panel');
    const interactionToggle = document.getElementById('interaction-toggle');

    let age = 0;
    let friendliness = 0;
    let hunger = 0;
    let breed = '';
    let dogName = '';
    let eventTimer, ageTimer;
    let growthStage = 0; // 0:ì‹ ìƒì•„, 1:ì²­ì†Œë…„, 2:ì„±ê²¬, 3:ë…¸ë ¹ê¸°
    let isGrowing = false;
    let gameEnded = false;

    const dogImages = {
      g: ['g1.png', 'g2.png', 'g3.png', 'g4.png'],
      b: ['b1.png', 'b2.png', 'b3.png', 'b4.png']
    };

    const growthMessages = ['ğŸ‘¶ ì‹ ìƒì•„ê¸°', 'ğŸ§’ ì²­ì†Œë…„ê¸°', 'ğŸ• ì„±ê²¬ê¸°', 'ğŸ¦® ë…¸ë ¹ê¸°'];

    const randomEvents = [
      { text: 'ë°°ê³ íŒŒí•˜ëŠ” ê²ƒ ê°™ì•„ìš”.', choices: ['ê°„ì‹ì„ ì¤€ë‹¤', 'ë¬´ì‹œí•œë‹¤'], effect: [2, -1] },
      { text: 'ì‚°ì±…ì„ ë‚˜ê°€ê³  ì‹¶ì–´ í•´ìš”.', choices: ['ì‚°ì±…ì„ ë‚˜ê°„ë‹¤', 'ë¬´ì‹œí•œë‹¤'], effect: [3, -2] },
      { text: 'ê°™ì´ ë†€ê³  ì‹¶ì–´ í•´ìš”.', choices: ['ê°™ì´ ë…¼ë‹¤', 'ë¬´ì‹œí•œë‹¤'], effect: [2, -1] },
      { text: 'ì§–ëŠ” ê±¸ ë©ˆì¶”ì§€ ì•Šì•„ìš”.', choices: ['ì•ˆì•„ì¤€ë‹¤', 'ë¬´ì‹œí•œë‹¤'], effect: [1, -1] },
      { text: 'ê¸°ìš´ì´ ì—†ì–´ ë³´ì—¬ìš”.', choices: ['ê°„ì‹ì„ ì¤€ë‹¤', 'ë¬´ì‹œí•œë‹¤'], effect: [2, -2] },
      { text: 'ê·€ì°®ê²Œ êµ´ì–´ìš”.', choices: ['ë¬´ë¦ì— ì•‰íŒë‹¤', 'ë¬´ì‹œí•œë‹¤'], effect: [2, -1] },
      { text: 'ê°‘ìê¸° ì§–ì–´ìš”!', choices: ['ì“°ë‹¤ë“¬ëŠ”ë‹¤', 'ë¬´ì‹œí•œë‹¤'], effect: [2, -1] },
      { text: 'ê·€ê°€ ê°„ì§€ëŸ¬ìš´ ê²ƒ ê°™ì•„ìš”.', choices: ['ê·€ë¥¼ ë‹¦ì•„ì¤€ë‹¤', 'ë¬´ì‹œí•œë‹¤'], effect: [2, -1] },
      { text: 'ë°°ë¥¼ ë³´ì—¬ìš”!', choices: ['ë°°ë¥¼ ì“°ë‹¤ë“¬ëŠ”ë‹¤', 'ë¬´ì‹œí•œë‹¤'], effect: [3, -1] },
      { text: 'ì ì´ ì•ˆ ì˜¤ëŠ” ê²ƒ ê°™ì•„ìš”.', choices: ['ìì¥ê°€ë¥¼ ë¶ˆëŸ¬ì¤€ë‹¤', 'ë¬´ì‹œí•œë‹¤'], effect: [2, -2] }
    ];

    interactionToggle.onclick = () => {
      interactionPanel.style.display = interactionPanel.style.display === 'flex' ? 'none' : 'flex';
    };
    function updateStatusPanel() {
      document.getElementById('age-value').textContent = age;
      document.getElementById('friendliness-value').textContent = friendliness;
      document.getElementById('hunger-value').textContent = hunger;
    }

    function showEvent(text, choiceA, choiceB, effectA, effectB) {
      isGrowing = true;
      document.getElementById('event-message').textContent = `${dogName}ì´(ê°€) ${text}`;
      document.getElementById('event-choices').style.display = 'flex';
      document.getElementById('choiceA').textContent = choiceA;
      document.getElementById('choiceB').textContent = choiceB;

      const handleChoice = (effect) => {
        friendliness += effect;
        hunger += (effect > 0 ? -1 : 1);
        updateStatusPanel();
        document.getElementById('event-choices').style.display = 'none';
        isGrowing = false;
      };

      document.getElementById('choiceA').onclick = () => handleChoice(effectA);
      document.getElementById('choiceB').onclick = () => handleChoice(effectB);
    }

    function triggerRandomEvent() {
      if (isGrowing || gameEnded) return;
      const i = Math.floor(Math.random() * randomEvents.length);
      const e = randomEvents[i];
      showEvent(e.text, e.choices[0], e.choices[1], e.effect[0], e.effect[1]);
    }

    function triggerGrowth() {
      if (isGrowing || gameEnded) return;
      growthStage++;
      if (growthStage > 3) {
        setTimeout(showEnding, 60000);
        return;
      }
      isGrowing = true;
      const growthDiv = document.createElement('div');
      growthDiv.className = 'event-box';
      growthDiv.innerHTML = `<strong>ğŸ‰ ${dogName}ì´(ê°€) ${growthMessages[growthStage]}ë¡œ ì„±ì¥í–ˆì–´ìš”!</strong><br><button onclick="continueAfterGrowth(this)">ì¶•í•˜í•´</button>`;
      document.getElementById('event').appendChild(growthDiv);
      updateDogImage();
    }

    function continueAfterGrowth(btn) {
      btn.parentElement.remove();
      isGrowing = false;
    }

    function updateDogImage() {
      dogImg.src = `https://dessa1995.github.io/dessa/${dogImages[breed][growthStage]}`;
    }

    function startTimers() {
      updateStatusPanel();
      eventTimer = setInterval(() => {
        timeUntilEvent -= 1;
        if (timeUntilEvent <= 0) {
          timeUntilEvent = 5;
          triggerRandomEvent();
        }
        document.getElementById('timer').textContent = timeUntilEvent;
      }, 1000);

      ageTimer = setInterval(() => {
        age++;
        updateStatusPanel();
        if (age === 2 || age === 6 || age === 10) {
          triggerGrowth();
        }
      }, 20000);
    }
    function showEnding() {
      clearInterval(eventTimer);
      clearInterval(ageTimer);
      gameEnded = true;

      const album = document.createElement('div');
      album.className = 'event-box';
      album.innerHTML = `
        <strong>ğŸ“¸ ì¶”ì–µ ì•¨ë²”</strong><br>
        <p>${dogName}ì´(ê°€) ì˜ˆì˜ê³  ë©‹ì§€ê²Œ ìëì–´ìš”!</p>
        <img src="${dogImg.src}" style="width:200px; border-radius:16px; margin:10px 0;">
        <p>ì¹œë°€ë„: ${friendliness} / ë°°ê³ í””: ${hunger}</p>
        <button onclick="restartGame()">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
      `;
      document.getElementById('event').appendChild(album);
    }

    function restartGame() {
      location.reload();
    }

    // ë°°ê²½ìŒì•… ê°•ì œ ì‹œì‘ (Chrome ë“± ì¼ë¶€ ë¸Œë¼ìš°ì € ì •ì±… ëŒ€ì‘)
    document.addEventListener('click', () => {
      const bgm = document.getElementById('bgm');
      if (bgm && bgm.paused) bgm.play().catch(() => {});
    }, { once: true });
  </script>
</body>
</html>
