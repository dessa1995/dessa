<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë‚˜ë§Œì˜ ê°•ì•„ì§€ í‚¤ìš°ê¸° ğŸ¶</title>
  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
    body {
      margin: 0;
      font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
      background-color: #fefae0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    h1 {
      margin: 20px;
      font-size: 2.5rem;
      color: #d4a373;
    }
    #game-wrapper {
      width: 95%;
      max-width: 1000px;
      aspect-ratio: 4 / 3;
      position: relative;
      background: #ffffff;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      border: 10px solid #ffffff;
    }
    canvas {
      width: 100%;
      height: 100%;
      display: block;
      cursor: pointer;
    }
    audio {
      display: none;
    }
    .emotion-icon {
      position: absolute;
      bottom: 10px;
      right: 10px;
      font-size: 36px;
    }
    .screen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .active {
      display: flex !important;
    }
    .button {
      padding: 12px 24px;
      margin: 10px;
      font-size: 1.1rem;
      background: #ffcdcd;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: background 0.2s;
    }
    .button:hover {
      background: #ffa4a4;
    }
    .info-box {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.95);
      padding: 10px 15px;
      border-radius: 15px;
      font-size: 0.95rem;
      line-height: 1.4;
      border: 1px solid #ffdad5;
    }
    .event-box {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #fff3cd;
      color: #865500;
      padding: 15px;
      border: 2px dashed #ffd6a5;
      border-radius: 15px;
      display: none;
      font-size: 1rem;
      text-align: center;
      width: 90%;
      max-width: 600px;
    }
    .celebrate {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2.2rem;
      background: #fff3cd;
      color: #d9480f;
      padding: 15px 25px;
      border: 2px solid #ffd6a5;
      border-radius: 20px;
      box-shadow: 0 5px 10px rgba(0,0,0,0.1);
      z-index: 999;
      display: none;
    }
    .interaction-toggle {
      margin-top: 20px;
    }
    .interaction-panel {
      display: none;
      flex-direction: column;
      align-items: center;
      margin-top: 10px;
    }
    .interaction-panel .button {
      background: #d2f4dc;
      margin: 5px;
    }
    .progress-bar {
      height: 12px;
      border-radius: 10px;
      background-color: #eee;
      margin-bottom: 8px;
      overflow: hidden;
    }
    .progress-bar-inner {
      height: 100%;
      transition: width 0.3s ease-in-out;
    }
    .hunger { background-color: #ffaeae; }
    .affection { background-color: #9de0ad; }
    .fade-out {
      animation: fadeout 2s forwards;
    }
    @keyframes fadeout {
      to { opacity: 0; display: none; }
    }
  </style>
</head>
<body>
  <h1>ğŸ¶ ë‚˜ë§Œì˜ ê°•ì•„ì§€ í‚¤ìš°ê¸°</h1>

  <div id="start-screen" class="screen active">
    <button class="button" onclick="goToBreedSelect()">ê²Œì„ ì‹œì‘</button>
  </div>

  <div id="breed-screen" class="screen">
    <p>ê°•ì•„ì§€ í’ˆì¢…ì„ ì„ íƒí•˜ì„¸ìš”:</p>
    <button class="button" onclick="selectBreed('g')">ê³¨ë“  ë¦¬íŠ¸ë¦¬ë²„</button>
    <button class="button" onclick="selectBreed('b')">ë¹„ìˆ‘ í”„ë¦¬ì œ</button>
  </div>

  <div id="name-screen" class="screen">
    <p>ê°•ì•„ì§€ ì´ë¦„ì„ ì§€ì–´ì£¼ì„¸ìš”:</p>
    <input type="text" id="puppy-name" placeholder="ì˜ˆ: ë­‰ì¹˜" />
    <button class="button" onclick="startGame()">ì‹œì‘í•˜ê¸°</button>
  </div>

  <div id="game-screen" class="screen">
    <div id="game-wrapper">
      <canvas id="gameCanvas" width="800" height="600"></canvas>
      <div class="info-box" id="statusBar">
        <div>ë‚˜ì´: <span id="age">0</span>ì‚´</div>
        <div>ë°°ê³ í””</div>
        <div class="progress-bar"><div id="hungerBar" class="progress-bar-inner hunger" style="width: 50%"></div></div>
        <div>ì¹œë°€ë„</div>
        <div class="progress-bar"><div id="affectionBar" class="progress-bar-inner affection" style="width: 50%"></div></div>
      </div>
      <div class="event-box" id="eventBox"></div>
      <div class="celebrate" id="celebrate">ğŸ‰ ì„±ì¥í–ˆì–´ìš”!</div>
      <div class="emotion-icon" id="emotion">ğŸ˜</div>
    </div>

    <div class="interaction-toggle">
      <button class="button" onclick="toggleInteractionPanel()">ì§ì ‘ ìƒí˜¸ì‘ìš© ğŸ”</button>
    </div>
    <div class="interaction-panel" id="interactionPanel">
      <button class="button" onclick="directInteraction('ì“°ë‹¤ë“¬ê¸°')">ì“°ë‹¤ë“¬ê¸°</button>
      <button class="button" onclick="directInteraction('ê·€ ëƒ„ìƒˆ ë§¡ê¸°')">ê·€ ëƒ„ìƒˆ ë§¡ê¸°</button>
      <button class="button" onclick="directInteraction('ë°œ ëƒ„ìƒˆ ë§¡ê¸°')">ë°œ ëƒ„ìƒˆ ë§¡ê¸°</button>
      <button class="button" onclick="directInteraction('ê»´ì•ˆê¸°')">ê»´ì•ˆê¸°</button>
    </div>

    <audio id="bgm" autoplay loop>
      <source src="https://dessa1995.github.io/dessa/bgm.mp3" type="audio/mp3" />
    </audio>
  </div>
  <div id="end-screen" class="screen">
    <h2 id="end-message"></h2>
    <div id="memory-album"></div>
    <button class="button" onclick="restartGame()">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
  </div>

  <script>
    let puppyName = "";
    let breed = "g";
    let age = 0;
    let hunger = 50;
    let affection = 50;
    let emotion = "ğŸ˜";
    let isGrowing = false;
    let hasEnded = false;
    let memoryImages = [];

    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const bgm = document.getElementById("bgm");
    const statusBar = document.getElementById("statusBar");
    const eventBox = document.getElementById("eventBox");
    const ageSpan = document.getElementById("age");
    const hungerBar = document.getElementById("hungerBar");
    const affectionBar = document.getElementById("affectionBar");
    const emotionIcon = document.getElementById("emotion");

    function goToBreedSelect() {
      showScreen("breed-screen");
    }

    function selectBreed(type) {
      breed = type;
      showScreen("name-screen");
    }

    function startGame() {
      puppyName = document.getElementById("puppy-name").value.trim() || "ë©ë©ì´";
      showScreen("game-screen");
      bgm.volume = 0.3;
      bgm.play();
      startTimers();
      drawPuppy();
    }

    function showScreen(id) {
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    function toggleInteractionPanel() {
      const panel = document.getElementById("interactionPanel");
      panel.style.display = (panel.style.display === "flex") ? "none" : "flex";
    }

    function updateStatus() {
      ageSpan.textContent = age;
      hungerBar.style.width = hunger + "%";
      affectionBar.style.width = affection + "%";
      emotionIcon.textContent = emotion;
    }

    function drawPuppy() {
      let img = new Image();
      let stage = "g1";
      if (age < 2) stage = "g1";
      else if (age < 6) stage = "g2";
      else if (age < 10) stage = "g3";
      else stage = "g4";
      if (breed === "b") stage = stage.replace("g", "b");
      img.src = `https://dessa1995.github.io/dessa/${stage}.png`;
      img.onload = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 200, 100, 400, 400);
      };
      memoryImages.push(stage);
    }

    function directInteraction(action) {
      affection = Math.min(100, affection + 5);
      hunger = Math.max(0, hunger - 2);
      emotion = "ğŸ˜";
      showEvent(`${action}ì„(ë¥¼) í–ˆì–´ìš”!`);
      updateStatus();
      drawPuppy();
    }

    function showEvent(msg) {
      eventBox.innerHTML = `<div class="event-message">${msg}</div>`;
      setTimeout(() => {
        eventBox.innerHTML = "";
        emotion = "ğŸ˜";
        updateStatus();
      }, 3000);
    }

    function startTimers() {
      setInterval(() => {
        if (hasEnded || isGrowing) return;
        triggerRandomEvent();
      }, 5000);

      setInterval(() => {
        if (hasEnded || isGrowing) return;
        age++;
        if ([2, 6, 10].includes(age)) {
          triggerGrowth();
        } else {
          updateStatus();
          drawPuppy();
        }
        if (age >= 11) {
          setTimeout(checkEnd, 60000); // 1ë¶„ í›„ ì¢…ë£Œ í™•ì¸
        }
      }, 20000);
    }

    function triggerGrowth() {
      isGrowing = true;
      document.getElementById("celebrate").style.display = "block";
      emotion = "ğŸ‰";
      drawPuppy();
    }

    function confirmGrowth() {
      document.getElementById("celebrate").style.display = "none";
      isGrowing = false;
      updateStatus();
    }
    const randomEvents = [
      "ì‚°ì±… ë‚˜ê°€ê³  ì‹¶ì–´í•´ìš”!",
      "ë¬¼ê·¸ë¦‡ì„ ë°œë¡œ ì°¼ì–´ìš”!",
      "í–‡ì‚´ ì¢‹ì€ ë‚ ì”¨ì— ê¸°ë¶„ì´ ì¢‹ì•„ìš”!",
      "ê°„ì‹ì„ ì°¾ê³  ìˆì–´ìš”!",
      "ì¥ë‚œê°ì„ ë¬¼ê³  í”ë“¤ì–´ìš”!",
      "ê·€ë¥¼ ë°”ë‹¥ì— ë¹„ë²¼ìš”!",
      "ì ì´ ì†”ì†” ì˜¤ëŠ” ëˆˆë¹›ì´ì—ìš”.",
      "í˜¼ì ë†€ê³  ìˆì–´ìš”.",
      "ê¼¬ë¦¬ë¥¼ í”ë“¤ë©° ë°˜ê²¨ìš”!",
      "ì°½ë°–ì„ ë°”ë¼ë³´ê³  ìˆì–´ìš”.",
      "ë°°ë¥¼ ë³´ì—¬ìš”! ê·€ì—¬ì›Œìš”!",
      "ë¬´ì–¸ê°€ë¥¼ ëª°ë˜ ë¬¼ì–´ì™”ì–´ìš”!",
      "ì£¼ì¸ì˜ ë°œì„ í•¥ì•„ìš”!",
      "ì†ì„ ë‹¬ë¼ê³  í•´ìš”!",
      "ì£¼ë³€ì„ í‚í‚ê±°ë ¤ìš”!",
      "ë©í•˜ë‹ˆ í•œ ê³³ì„ ë°”ë¼ë´ìš”!",
      "ë°©ì„ì„ íŒŒí—¤ì³ìš”!",
      "ì½§ì†Œë¦¬ë¥¼ ë‚´ë©° ì¡¸ê³  ìˆì–´ìš”!",
      "ì£¼ì¸ì„ ì˜¬ë ¤ë‹¤ë´ìš”!",
      "ê¸°ëŒ€ì–´ ì•‰ì•„ ìˆì–´ìš”."
    ];

    function triggerRandomEvent() {
      const event = randomEvents[Math.floor(Math.random() * randomEvents.length)];
      affection = Math.min(100, affection + 2);
      hunger = Math.max(0, hunger - 1);
      emotion = "ğŸ˜Š";
      showEvent(event);
      updateStatus();
    }

    function checkEnd() {
      if (hasEnded) return;
      hasEnded = true;
      showScreen("end-screen");
      const msg = `${puppyName}ì´ê°€ ì˜ˆì˜ê³  ë©‹ì§€ê²Œ ìëì–´ìš”!`;
      document.getElementById("end-message").textContent = msg;
      renderMemoryAlbum();
      bgm.pause();
    }

    function renderMemoryAlbum() {
      const container = document.getElementById("memory-album");
      container.innerHTML = "";
      const seen = new Set();
      memoryImages.forEach(stage => {
        if (seen.has(stage)) return;
        seen.add(stage);
        const img = document.createElement("img");
        img.src = `https://dessa1995.github.io/dessa/${stage}.png`;
        img.style.width = "120px";
        img.style.margin = "10px";
        container.appendChild(img);
      });
    }

    function restartGame() {
      location.reload();
    }
  </script>
</body>
</html>
