<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ê°•ì•„ì§€ í‚¤ìš°ê¸° ê²Œì„</title>
  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Pretendard', sans-serif;
      background: #fffdf7;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      margin: 20px;
      font-size: 2.5rem;
      color: #ff9e57;
    }
    .screen {
      display: none;
      flex-direction: column;
      align-items: center;
    }
    .screen.active {
      display: flex;
    }
    .button {
      padding: 10px 20px;
      margin: 10px;
      background: #ffe5b4;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .button:hover {
      background: #ffd194;
    }
    #game-wrapper {
      width: 95%;
      max-width: 960px;
      aspect-ratio: 4 / 3;
      background: #ffffff;
      border: 10px solid #fff1e0;
      border-radius: 20px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    #gameCanvas {
      width: 100%;
      height: 100%;
      background: #fdfdfd;
      display: block;
    }
    .status-bar {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.9);
      padding: 10px 15px;
      border-radius: 15px;
      font-size: 0.9rem;
      line-height: 1.4;
      border: 1px solid #ffcfa3;
    }
    .event-box {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #fff3e0;
      padding: 10px 20px;
      border-radius: 15px;
      border: 1px solid #ffc107;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      font-size: 1rem;
      text-align: center;
      max-width: 90%;
    }
    .event-buttons {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    .interaction-toggle, .interaction-panel {
      margin-top: 15px;
    }
    .interaction-panel {
      display: none;
      flex-direction: column;
      align-items: center;
    }
    .interaction-panel .button {
      background: #e3fceb;
      color: #006d5b;
    }
    .interaction-panel .button:hover {
      background: #c2f0db;
    }
    #event-timer {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255, 240, 200, 0.9);
      padding: 10px 15px;
      border-radius: 15px;
      font-size: 0.9rem;
      color: #a25a00;
      border: 1px dashed #ffb74d;
    }
    .celebration {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2rem;
      color: #ff4081;
      background: #fff0f7;
      border: 2px solid #ffb0d4;
      border-radius: 15px;
      padding: 15px 25px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      display: none;
    }
  </style>
</head>
<body>
  <h1>ğŸ¶ ë‚˜ë§Œì˜ ê°•ì•„ì§€ í‚¤ìš°ê¸°</h1>
  <audio id="bgm" autoplay loop>
    <source src="https://dessa1995.github.io/dessa/bgm.mp3" type="audio/mp3" />
  </audio>

  <div id="start-screen" class="screen active">
    <button class="button" onclick="goToBreedScreen()">ê²Œì„ ì‹œì‘</button>
  </div>

  <div id="breed-screen" class="screen">
    <p>ê°•ì•„ì§€ í’ˆì¢…ì„ ê³¨ë¼ì£¼ì„¸ìš”:</p>
    <button class="button" onclick="selectBreed('g')">ê³¨ë“  ë¦¬íŠ¸ë¦¬ë²„</button>
    <button class="button" onclick="selectBreed('b')">ë¹„ìˆ‘ í”„ë¦¬ì œ</button>
  </div>
  <div id="name-screen" class="screen">
    <p>ê°•ì•„ì§€ ì´ë¦„ì„ ì§€ì–´ì£¼ì„¸ìš”:</p>
    <input type="text" id="puppy-name-input" placeholder="ì´ë¦„ ì…ë ¥" class="button" />
    <button class="button" onclick="startGame()">ì‹œì‘!</button>
  </div>

  <div id="game-screen" class="screen">
    <div id="game-wrapper">
      <canvas id="gameCanvas" width="800" height="600"></canvas>
      <div class="status-bar" id="statusBar">
        ë‚˜ì´: <span id="age">0</span>ì‚´<br>
        ì¹œë°€ë„: <span id="affection">50</span><br>
        ë°°ê³ í””: <span id="hunger">50</span>
      </div>
      <div id="event-timer">ë‹¤ìŒ ì´ë²¤íŠ¸ê¹Œì§€: <span id="eventCountdown">5</span>ì´ˆ</div>
      <div class="event-box" id="eventBox" style="display:none;">
        <div id="eventText"></div>
        <div class="event-buttons" id="eventButtons"></div>
      </div>
      <div class="interaction-toggle">
        <button class="button" onclick="toggleInteractions()">ì§ì ‘ ìƒí˜¸ì‘ìš© ì—´ê¸°/ë‹«ê¸°</button>
      </div>
      <div class="interaction-panel" id="interactionPanel">
        <button class="button" onclick="interact('ê·€ ëƒ„ìƒˆ ë§¡ê¸°')">ê·€ ëƒ„ìƒˆ ë§¡ê¸°</button>
        <button class="button" onclick="interact('ë°œ ëƒ„ìƒˆ ë§¡ê¸°')">ë°œ ëƒ„ìƒˆ ë§¡ê¸°</button>
        <button class="button" onclick="interact('ê»´ì•ˆê¸°')">ê»´ì•ˆê¸°</button>
        <button class="button" onclick="interact('ì“°ë‹¤ë“¬ê¸°')">ì“°ë‹¤ë“¬ê¸°</button>
      </div>
      <div class="celebration" id="celebration">ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!</div>
    </div>
  </div>

  <div id="ending-screen" class="screen">
    <h2 id="ending-message"></h2>
    <button class="button" onclick="restartGame()">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
  </div>

  <script>
    let currentScreen = "start-screen";
    const puppy = {
      name: "",
      breed: "",
      age: 0,
      affection: 50,
      hunger: 50,
      stage: 0,
      imageMap: {
        g: ["g1.png", "g2.png", "g3.png", "g4.png"],
        b: ["b1.png", "b2.png", "b3.png", "b4.png"]
      }
    };

    function switchScreen(id) {
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      currentScreen = id;
    }

    function goToBreedScreen() {
      switchScreen("breed-screen");
    }

    function selectBreed(breed) {
      puppy.breed = breed;
      switchScreen("name-screen");
    }

    function startGame() {
      puppy.name = document.getElementById("puppy-name-input").value || "ê°•ì•„ì§€";
      switchScreen("game-screen");
      drawPuppy();
      startTimers();
    }

    function restartGame() {
      location.reload();
    }

    function toggleInteractions() {
      const panel = document.getElementById("interactionPanel");
      panel.style.display = panel.style.display === "flex" ? "none" : "flex";
    }

    function interact(action) {
      const affectionChange = 5;
      const hungerChange = -3;
      puppy.affection = Math.min(100, puppy.affection + affectionChange);
      puppy.hunger = Math.max(0, puppy.hunger + hungerChange);
      updateStatus();
      showTemporaryEffect(`ğŸ’– ${action}! ì¹œë°€ë„ +${affectionChange}`);
    }

    function showTemporaryEffect(text) {
      const celebration = document.getElementById("celebration");
      celebration.innerText = text;
      celebration.style.display = "block";
      setTimeout(() => {
        celebration.style.display = "none";
      }, 1500);
    }
  </script>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const imageBaseURL = "https://dessa1995.github.io/dessa/";

    function drawPuppy() {
      const stage = puppy.stage;
      const breedKey = puppy.breed === "golden" ? "g" : "b";
      const imageSrc = imageBaseURL + puppy.imageMap[breedKey][stage];
      const img = new Image();
      img.src = imageSrc;
      img.onload = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 300, 150, 200, 200);
      };
    }

    function updateStatus() {
      document.getElementById("age").innerText = puppy.age;
      document.getElementById("affection").innerText = puppy.affection;
      document.getElementById("hunger").innerText = puppy.hunger;
    }

    function startTimers() {
      updateStatus();
      setInterval(() => {
        if (!isEventActive) {
          puppy.age += 1;
          updateStage();
          updateStatus();
        }
      }, 20000); // 20ì´ˆë§ˆë‹¤ í•œ ì‚´

      startEventCountdown();
    }

    function updateStage() {
      if (puppy.age < 2) {
        puppy.stage = 0;
      } else if (puppy.age < 6) {
        puppy.stage = 1;
      } else if (puppy.age < 10) {
        puppy.stage = 2;
      } else {
        if (puppy.stage !== 3) {
          puppy.stage = 3;
          triggerGrowthAnimation();
        }
      }
      drawPuppy();
    }

    function triggerGrowthAnimation() {
      const imgEl = canvas;
      imgEl.style.transition = "transform 0.4s ease";
      imgEl.style.transform = "scale(1.2)";
      setTimeout(() => {
        imgEl.style.transform = "scale(1)";
      }, 400);

      const celebration = document.getElementById("celebration");
      celebration.innerText = "ğŸ‰ ì„±ì¥í–ˆì–´ìš”!";
      celebration.style.display = "block";
      setTimeout(() => {
        celebration.style.display = "none";
        triggerRandomEvent(); // ì„±ì¥ ì´í›„ ì´ë²¤íŠ¸ ë“±ì¥
      }, 1800);
    }

    let eventCountdown = 5;
    let isEventActive = false;

    function startEventCountdown() {
      setInterval(() => {
        if (!isEventActive) {
          eventCountdown--;
          if (eventCountdown <= 0) {
            triggerRandomEvent();
            eventCountdown = 5;
          }
          document.getElementById("eventCountdown").innerText = eventCountdown;
        }
      }, 1000); // ë§¤ì´ˆ ì¹´ìš´íŠ¸ë‹¤ìš´
    }

    const events = [
      { text: "ë°°ê³ íŒŒí•´ìš”!", choices: ["ê°„ì‹ì„ ì¤€ë‹¤", "ë¬´ì‹œí•œë‹¤"], effect: [5, -5] },
      { text: "ì‚°ì±…í•˜ê³  ì‹¶ì–´í•´ìš”!", choices: ["ê°™ì´ ë‚˜ê°„ë‹¤", "ë‚˜ì¤‘ì— ê°€ì"], effect: [5, -3] },
      { text: "ë†€ê³  ì‹¶ì–´í•´ìš”!", choices: ["ê°™ì´ ë…¼ë‹¤", "ë¬´ì‹œí•œë‹¤"], effect: [4, -4] },
      { text: "ì ì´ ì˜¨ë‹¤ê³  í•´ìš”!", choices: ["ìê²Œ ë‘”ë‹¤", "ê³„ì† ë…¼ë‹¤"], effect: [3, -3] },
      { text: "ê°„ì‹ì„ ë” ë‹¬ë¼ê³  í•´ìš”!", choices: ["ì¤€ë‹¤", "ê·¸ë§Œ"], effect: [5, -5] },
      { text: "ì¥ë‚œê°ì„ ê¹¨ë¬¼ì–´ìš”!", choices: ["ìƒˆ ì¥ë‚œê° ì¤Œ", "í˜¼ë‚¸ë‹¤"], effect: [4, -4] },
      { text: "ë¹„ ì˜¤ëŠ” ë‚  ë¬´ì„œì›Œí•´ìš”!", choices: ["ì•ˆì•„ì¤€ë‹¤", "ê·¸ëƒ¥ ë‘”ë‹¤"], effect: [6, -4] },
      { text: "ë°©ê·€ ë€Œê³  ë‹¹í™©í•´ìš”!", choices: ["ì›ƒì–´ì¤€ë‹¤", "ë¬´ì‹œí•œë‹¤"], effect: [3, -2] },
      { text: "ìƒˆë¡œìš´ ëª…ë ¹ì–´ ë°°ìš°ê³  ì‹¶ì–´í•´ìš”!", choices: ["ê°€ë¥´ì¹œë‹¤", "ì§€ì¼œë³¸ë‹¤"], effect: [5, -3] },
      { text: "ì£¼ì¸ì„ ë¬¼ë„ëŸ¬ë¯¸ ì³ë‹¤ë´ìš”!", choices: ["ëˆˆ ë§ˆì£¼ì¹˜ê³  ì›ƒëŠ”ë‹¤", "ëª¨ë¥¸ì²™"], effect: [4, -4] }
    ];
    function triggerRandomEvent() {
      isEventActive = true;
      const random = events[Math.floor(Math.random() * events.length)];
      const eventBox = document.getElementById("event-box");
      const text = document.getElementById("event-text");
      const choices = document.getElementById("event-choices");

      text.innerText = `${puppy.name}ì´ê°€ ${random.text}`;
      choices.innerHTML = "";

      random.choices.forEach((choice, index) => {
        const btn = document.createElement("button");
        btn.innerText = choice;
        btn.style.margin = "10px";
        btn.onclick = () => {
          puppy.affection += random.effect[index];
          puppy.hunger += index === 0 ? -3 : 2;
          updateStatus();
          text.innerText = index === 0 ? "ğŸ˜Š ê¸°ë»í•´ìš”!" : "ğŸ˜¢ ì‹¤ë§í•œ ê²ƒ ê°™ì•„ìš”...";
          setTimeout(() => {
            eventBox.style.display = "none";
            isEventActive = false;
          }, 1500);
        };
        choices.appendChild(btn);
      });

      eventBox.style.display = "block";
    }

    function toggleInteraction() {
      const box = document.getElementById("interaction-box");
      box.style.display = box.style.display === "none" ? "flex" : "none";
    }

    function interact(effectText) {
      const text = document.getElementById("event-text");
      const eventBox = document.getElementById("event-box");
      puppy.affection += 2;
      puppy.hunger -= 1;
      updateStatus();
      text.innerText = effectText;
      eventBox.style.display = "block";
      setTimeout(() => {
        eventBox.style.display = "none";
      }, 1200);
    }

    // ìŒì•… ë‹¤ì‹œ ë³´ì¥
    window.onload = () => {
      const audio = document.getElementById("bgm");
      audio.play().catch(() => {
        document.body.addEventListener('click', () => {
          audio.play();
        }, { once: true });
      });
    };

    // ì‹œì‘ í›„ ì´ë¦„ ì§“ê¸°ê¹Œì§€ ì™„ë£Œ ì‹œ ê²Œì„ ì‹œì‘
    function proceedGame() {
      document.getElementById("setup-screen").style.display = "none";
      document.getElementById("main-screen").style.display = "block";
      puppy.name = document.getElementById("puppyName").value || "ê°•ì•„ì§€";
      drawPuppy();
      startTimers();
    }
  </script>
</body>
</html>
